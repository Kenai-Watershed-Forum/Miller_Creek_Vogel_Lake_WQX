# Rotenone monitoring

```{r , include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

# clear environment
rm(list=ls())

# load packages
library(bookdown)
library(tidyverse)
library(googlesheets4)
library(lubridate)
library(readr)
library(readxl)
library(writexl)
library(fs)
library(janitor)
library(hms)
library(plotly)
library(DT)
library(xlsx)
library(leaflet)
library(DT)
library(ggpubr)
library(plotrix)
library(packrat)
library(kableExtra)

# set plotting themes

## geom_col plots theme
col_theme <- theme(axis.title = element_text(size = 14, face = "bold"),
                   strip.text = element_text(size = 14, face = "bold"),
                   legend.title = element_text(size = 14, face = "bold"),
                   legend.text = element_text(size = 14),
                   axis.text = element_text(size = 14))

## geom_points plots theme
points_theme <- theme(axis.title = element_text(size = 14, face = "bold"),
                   strip.text = element_text(size = 14, face = "bold"),
                   legend.title = element_text(size = 14, face = "bold"),
                   legend.text = element_text(size = 14),
                   axis.text = element_text(size = 11, face = "bold"),
                   title = element_text(size = 18))

# function to exclude multiple items per column
'%ni%' <- Negate('%in%')

# clarify select function
select <- dplyr::select
```

Rotenone application was performed in early October 2021 by ADF&G. ADF&G collected pre and post-treatment water samples as part of this event, and Kenai Watershed Forum will monitor degradation through until Summer 2022. Methods and results will be described here.


## Sampling schedule
A proposed rotenone sampling schedule is described in table \@ref(tab:sample-schedule) or may be accessed in a Google Sheet linked here: <https://tinyurl.com/8ba94nrn>. Schedule is current as of `r Sys.Date()`.


```{r sample-schedule, echo = F, fig.cap = "cap"}
options(knitr.kable.NA = '')
# read in proposed schedule
url <- "https://docs.google.com/spreadsheets/d/1_lv-I471tu8WI55nItGslKYe_X5qvwZ_MF22M2jrkZo/edit#gid=0"
tab <- "rotenone_sample_schedule"
dat <- read_sheet(url, sheet = tab) 

# create table
dat %>%
  kbl(caption = "Vogel lake and Miller Creek rotenone sampling schedule") %>%
  kable_paper(full_width = F, html_font = "Cambria") 

#%>%
 # bootstrap_options = c("striped", "hover", "condensed", "responsive")
```

<br>

```{r, data prep, echo = F}

# read in all rotenone concentration data from csv files (sourced from excel files emailed from UAA)
data_dir <- "input/rotenone_data/rotenone_concentration_results/csv/"

rot_dat <- data_dir %>% 
  dir_ls(regexp = "\\.csv$") %>% 
  map_dfr(read_csv, .id = "source") 

# clean up very messy import

## rename
column_names <- c("source",
                  "sample_name",
                  "field_sample_date",
                  "lab_analysis_date",
                  "rotenone_ppb",
                  "rotenolone_ppb",
                  "deguelin_ppb",
                  "tephrosin_ppb",
                  "cft_5",
                  "cft_6")
colnames(rot_dat) <- column_names 

## remove empty columns
rot_dat <- remove_empty(rot_dat)

## remove empty rows and column name rows
rot_dat <- rot_dat %>%
  filter(!is.na(sample_name)) %>%
  filter(field_sample_date != "---") %>%
  filter(sample_name %ni% c("Sample Name*",
                            "*a and b denote separate extraction duplicates",
                            "**ND = Not Detected")) 


# use these data to do something like what rob did in excel

# say that more detailed accuracy resuts can be accessed in the repo folder in the excel files

# see journal article for methods

# need to average a and b lab dups, separate sample names into columns to distinguish depth
   

```

## Sample results
Laboratory analysis of water samples is performed by the ASET Laboratory at the University of Alaska Anchorage Department of Chemistry in Anchorage, Alaska. Results to date are available for download at the following link:

[Link: Rotenone Degradation Laboratory Results](https://github.com/Kenai-Watershed-Forum/Miller_Creek_Vogel_Lake_WQX/tree/main/input/rotenone_data). More detailed visualizations of these data are forthcoming.

```{r}



ggplotly(
  rot_dat %>%
    ggplot(aes(field_sample_date,rotenone_ppb)) +
    geom_point() +
    facet_grid()
  
  
  
)
  


```


