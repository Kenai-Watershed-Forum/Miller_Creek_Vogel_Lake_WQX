---
title: "Miller Creek and Vogel Lake Water Quality"
author: "Benjamin Meyer (ben@kenaiwatershed.org)"
date: "`r Sys.Date()`"
site: bookdown::bookdown_site
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
---

```{r}
library(bookdown)
library(tinytex)
library(packrat)

```

![](images/KWF_logo.png)

# Introduction

This draft document contains preliminary data explorations of 2021-2023 water quality data from the Vogel Lakes complex and Miller Creek in the Northern Kenai peninsula. These data are being collected as part of potential plans to eradicate invasive pike from the area, which were identified in 2018-2019 by the Alaska Dept. of Fish and Game.

The draft environmental assessment for potential eradication of invasive Northern Pike from this system is available from the [US Fish and Wildlife Service](https://www.fws.gov/uploadedFiles/Region_7/NWRS/Zone_2/Kenai/PDF/Draft%20EA%20Northern%20Pike%20KNWR.pdf).

Water quality and watershed characterization fieldwork for this project is conducted by [Kenai Watershed Forum](https://www.kenaiwatershed.org/).

An ArcGIS Online map of sites included in water quality monitoring efforts is found here: <https://arcg.is/0fqvb0>.

A [GitHub repository](https://github.com/Kenai-Watershed-Forum/Miller_Creek_Vogel_Lake_WQX "KWF GitHub") with the code generating this report is also available.

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Lake Water Quality Profiles

---
output:
  html_document: 
    df_print: paged
    fig_width: 10
    fig_height: 6
    fig_caption: yes
    code_folding: hide
    toc: true
    toc_depth: 4
    toc_float:
      collapsed: false
      smooth_scroll: false
editor_options: 
  chunk_output_type: inline
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = F, message = F)

# clear environment
rm(list=ls())

# load packages
library(tidyverse)
library(googlesheets4)
library(lubridate)
library(readr)
library(readxl)
library(writexl)
library(hms)
library(plotly)
library(DT)
library(xlsx)
library(leaflet)
library(DT)
library(ggpubr)
library(plotrix)
library(packrat)

# set plotting themes

## geom_col plots theme
col_theme <- theme(axis.title = element_text(size = 14, face = "bold"),
                   strip.text = element_text(size = 14, face = "bold"),
                   legend.title = element_text(size = 14, face = "bold"),
                   legend.text = element_text(size = 14),
                   axis.text = element_text(size = 14))

## geom_points plots theme
points_theme <- theme(axis.title = element_text(size = 14, face = "bold"),
                   strip.text = element_text(size = 14, face = "bold"),
                   legend.title = element_text(size = 14, face = "bold"),
                   legend.text = element_text(size = 14),
                   axis.text = element_text(size = 9),
                   title = element_text(size = 18))

# function to exclude multiple items per column
'%ni%' <- Negate('%in%')

# clarify select function
select <- dplyr::select
```

Lake water quality profiles were collected at 1-2 month intervals at five sites at 1 meter depth intervals. Raw water quality field data is stored in a Google Sheet that can be viewed at <https://tinyurl.com/kwf-vogel-wqx-data>.

Data visualizations are provided for each site visit here.

```{r, include = FALSE}
# Import data from google sheet

# Note to self: once project is complete and no more data updates are needed, migrate data source from Google Sheet to csvs in the local project "data" folder

# recognize sheet title and download
lake_wqx_dat <- read_sheet("https://docs.google.com/spreadsheets/d/1lS9eJ7kX91IlYwSgiEQm-BQqif_7o5E4MzcBmqpwSoI/edit#gid=0", 
                           sheet = "Lake_Profile_Measurements") %>%
  # rename columns
  rename(site = `Site Name`,
         sample_date = `Sample Date`,
         sample_depth_m = `Depth (m)`,
         sample_time = `Sample Time`,
         DO_mgl = `DO (mg/L)`,
         turbidity_ntu = `Turbidity (NTU)`,
         temp_c = `Temp (C)`,
         spcond_uscm = `SpCond (uS/cm)`) %>%
  select(-Notes,-QC1,-`Data Entry`,-`QC2`) %>%
  
  # transform column formats
  transform(sample_time = hms::as_hms(sample_time),
            pH = as.character(pH),
            DO_mgl = as.character(DO_mgl),
            turbidity_ntu = as.character(turbidity_ntu),
            temp_c = as.character(temp_c),
            spcond_uscm = as.character(temp_c)) %>%
  
  # convert data format from wide to long
  pivot_longer(cols = c("pH","DO_mgl","turbidity_ntu","temp_c","spcond_uscm"),
               names_to = "parameter",
               values_to = "val") %>%
  
  # remove missing values
  filter(!is.na(val)) %>%
  
  # remove values flagged with an asterisk
  # note that the asterisk is a special character, requires // escape for spring match
  filter(!str_detect(val, "\\*"))

```

```{r include = F}
# prep dataframe for plotting

# create parameter name replacements
param_names <- c("pH" = "pH",
                 "DO_mgl" = "DO\n(mg/L)",
                 "turbidity_ntu" = "Turbidity\n(NTU)",
                 "temp_c" = "Temperature\n(C)",
                 "spcond_uscm" = "Specific\nConductivity\n(uS/cm)")

# create site name replacements
site_names <- c("Vogel_Lake_Outlet" = "Vogel Lake Outlet", 
                "Vogel_Lake" = "Vogel Lake",        
                "North_Vogel_Lake" = "North Vogel Lake",
                "Bird_Pond" = "Bird Pond",
                "Vogel_Pond" = "Vogel Pond")

```

## January 2021

Jan 22, 2021

```{r ,include = FALSE}

# filter to january 2021 data data
jan21_lake_wqx_dat <- lake_wqx_dat %>%
  mutate(month = month(sample_date),
         year = year(sample_date)) %>%
  filter(month == "1",
         year == "2021")

# create plot
p <- jan21_lake_wqx_dat %>%
  ggplot() +
    geom_point(aes(sample_depth_m,val), size = 2) +
    geom_line(aes(sample_depth_m,val)) +

    coord_flip() +
    facet_grid(site ~ parameter, scales = "free_x", shrink = T, 
               labeller = labeller(parameter = param_names,
                                   site = site_names)) +
    ylab("") +
    xlab("Depth (m)") +
    theme_bw() +
    points_theme +
    scale_x_reverse() +
    scale_y_continuous(n.breaks = 5) +
    theme(panel.spacing = unit(1.2, "lines"),
          strip.text.y = element_text(angle = 360)) +
    ggtitle("January 2021 Water Quality All Sites")
```

```{r fig.width=10, fig.height=11}
p
```



## March 2021

March 23, 2021

```{r ,include = FALSE}

# filter to march 2021 data data
mar21_lake_wqx_dat <- lake_wqx_dat %>%
  mutate(month = month(sample_date),
         year = year(sample_date)) %>%
  filter(month == "3",
         year == "2021")

# create plot
p <- mar21_lake_wqx_dat %>%
  ggplot() +
    geom_point(aes(sample_depth_m,val), size = 2) +
    geom_line(aes(sample_depth_m,val)) +

    coord_flip() +
    facet_grid(site ~ parameter, scales = "free_x", shrink = T, 
               labeller = labeller(parameter = param_names,
                                   site = site_names)) +
    ylab("") +
    xlab("Depth (m)") +
    theme_bw() +
    points_theme +
    scale_x_reverse() +
    scale_y_continuous(n.breaks = 5) +
    theme(panel.spacing = unit(1.2, "lines"),
          strip.text.y = element_text(angle = 360)) +
    ggtitle("March 2021 Water Quality All Sites")
```

```{r fig.width=10, fig.height=11}
p
```



Plan:

add column for "data QC flag"; allow for exclusions
modify/copy code in order to be able to plot april/may/june data
create summary table of values
for each parameter, create tile plot of dpeth vs value: https://ggplot2.tidyverse.org/reference/geom_tile.html


***

## Site Summaries

A table of summary statistics for water quality parameters at each site will be provided here.

<!--chapter:end:01-lake_depth_profiles.Rmd-->

# Miller Creek Discharge

Field data to create a ratings curve of discharge at the mouth of Miller Creek is being collected from Fall 2020 - Spring 2021.  These methods and results will be presented here.

Raw water quality field data is stored in a Google Sheet that can be viewed at <https://tinyurl.com/kwf-vogel-wqx-data> under the "Discharge Measurements" tab.

Site photos are available through a point-and-click pop-up map at <https://arcg.is/0fqvb0>.

<!--chapter:end:02-miller_creek_discharge.Rmd-->

# Watershed Mapping

-   Watershed mapping efforts for this project include a combination of on the ground fieldwork and GIS based approaches.

-   An ArcGIS Online interactive map outlining fieldwork sites and associated results is found at the following link: <https://arcg.is/0Djmay>

[![](images/miller_map.png "Miller Creek and Vogel Lake Watershed"){width="500"}](https://arcg.is/1GeLTX)

<!--chapter:end:03-watershed_mapping.Rmd-->

# Rotenone monitoring

If rotenone application is included in the final plan after the Environmental Assessment process, Kenai Watershed Forum will monitor rotenone concentrations in the lake/creek system through Fall 2021 - Summer 2022.  Methods and results will be described here.

A proposed rotenone sampling schedule is described in a Google Sheet linked here: <https://tinyurl.com/8ba94nrn>

Actual sampling schedule will be dictated by observed decomposition rates.

<!--chapter:end:04-other.Rmd-->

# Summary

Overall results described and interpreted here.

<!--chapter:end:05-summary.Rmd-->

